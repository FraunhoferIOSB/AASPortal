<!-----------------------------------------------------------------------------
 !
 ! Copyright (c) 2019-2024 Fraunhofer IOSB-INA Lemgo,
 ! eine rechtlich nicht selbstaendige Einrichtung der Fraunhofer-Gesellschaft
 ! zur Foerderung der angewandten Forschung e.V.
 !
 !---------------------------------------------------------------------------->

<form (ngSubmit)="submit()">
    <div class="modal-header text-info">
        <h4 class="modal-title">
            <i class="bi bi-plus-circle"></i>
            <span class="ms-2" translate>CAPTION_ADD_ENDPOINT</span>
        </h4>
        <button type="button" class="btn-close" (click)="cancel()"> </button>
    </div>
    <div class="modal-body">
        @for (message of messages(); track message) {
        <ngb-toast [autohide]="false" class="bg-danger w-100 mb-3">
            <div class="d-flex">
                <div class="flex-grow-1">{{ message }}</div>
            </div>
        </ngb-toast>
        }
        <label class="form-lable" for="input-endpoint-name" translate>AddEndpointForm.LABEL_NAME</label>
        <input id="input-endpoint-name" type="text" class="form-control mb-3"
            placeholder="{{'AddEndpointForm.PLACEHOLDER_NAME' | translate}}" [(ngModel)]="name" name="name"
            (input)="inputValue()">
        <label class="form-lable" for="div-endpoint-url" translate>AddEndpointForm.LABEL_URL</label>
        <div class="input-group" ngbDropdown role="group" id="div-endpoint-url">
            <button type="button" class="btn btn-secondary" ngbDropdownToggle>{{'AddEndpointForm.' + item().type |
                translate}}</button>
            <div class="dropdown-menu" ngbDropdownMenu>
                @for (item of items(); track item) {
                <button type="button" (click)="setItem(item)" ngbDropdownItem>{{'AddEndpointForm.' + item.type |
                    translate}}</button>
                }
            </div>
            <input id="input-endpoint-url" type="text" class="form-control"
                placeholder="{{item().placeholder | translate}}" [(ngModel)]="item().value" name="value"
                (input)="inputValue()">
        </div>
        @if (item().type === 'AAS_API') {
        <div class="col-12" style="max-height: 200px; overflow-y: auto;">
            <table class="table table-sm table-striped table-borderless">
                <thead>
                    <th [style.width.px]="16"></th>
                    <th></th>
                    <th></th>
                    <th [style.width.px]="16"></th>
                </thead>
                <tbody>
                    @for (header of headers(); track header.name) {
                    <tr>
                        <td>
                            <input type="checkbox" class="form-check-input" [checked]="header.selected"
                                [(ngModel)]="header.selected" name="headerSelected" />
                        </td>
                        <td>
                            @if (!header.selected) {
                            <div class="small">{{header.name}}</div>
                            } @else {
                            <input type="text" class="form-control form-control-sm" [(ngModel)]="header.name"
                                placeholder="header name" name="headerName" />
                            }
                        </td>
                        <td>
                            @if (!header.selected) {
                            <div class="small">{{header.value}}</div>
                            } @else {
                            <input type="text" class="form-control form-control-sm" [(ngModel)]="header.value"
                                placeholder="value" name="headerValue" />
                            }
                        </td>
                        <td>
                            @if (header === lastHeader()) {
                            <a class="text-primary" href="javascript:void(0)" (click)="addHeader()">
                                <i class="bi bi-plus"></i>
                            </a>
                            } @else {
                            <a class="text-danger" href="javascript:void(0)" (click)="removeHeader(header)">
                                <i class="bi bi-dash"></i>
                            </a>
                            }
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>
        }
    </div>
    <div class="modal-footer">
        <button type="submit" class="btn btn-primary" translate>CMD_OK</button>
        <button type="button" class="btn btn-secondary" (click)="cancel()" translate>CMD_CANCEL</button>
    </div>
</form>