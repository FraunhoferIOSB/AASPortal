<!-----------------------------------------------------------------------------
 !
 ! Copyright (c) 2019-2024 Fraunhofer IOSB-INA Lemgo,
 ! eine rechtlich nicht selbstaendige Einrichtung der Fraunhofer-Gesellschaft
 ! zur Foerderung der angewandten Forschung e.V.
 !
 !---------------------------------------------------------------------------->

@if (document?.content) {
<table class="table table-sm table-hover table-striped align-middle">
    <thead>
        <tr>
            <th class="aas-tree-th-checkbox">
                <input type="checkbox" class="form-check-input" (change)="toggleSelections()"
                    [disabled]="state === 'online'" [indeterminate]="someSelected" [checked]="everySelected">
            </th>
            <th>
                <a class="link-secondary" href="javascript:void(0);" (click)="collapse()">
                    <i class="bi bi-dash-square-dotted"></i>
                </a>
            </th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @for (node of nodes; track node) {
        <tr [ngClass]="visualState(node)" [id]="node.id">
            <td>
                <input type="checkbox" class="form-check-input" (change)="toggleSelection(node)"
                    [checked]="node.selected" [disabled]="state === 'online'" />
            </td>
            <td [colSpan]="node.isLeaf ? 1 : 2">
                <div class="d-flex" style="overflow-x: hidden">
                    <div [ngStyle]="{'width': (node.level * 16) + 'px'}"></div>
                    @if (node.isLeaf) {
                    <div class="wh-4"></div>
                    }@else {
                    @if (node.expanded) {
                    <a href="javascript:void(0);" (click)="collapse(node)">
                        <div class="text-dark">
                            <i class="bi bi-dash-square"></i>
                        </div>
                    </a>
                    }@else {
                    @if (node.hasChildren) {
                    <a (click)="expand(node)" href="javascript:void(0);">
                        <div class="text-dark">
                            <i class="bi bi-plus-square"></i>
                        </div>
                    </a>
                    }@else {
                    <div class="text-muted">
                        <i class="bi bi-square"></i>
                    </div>
                    }
                    }
                    }

                    <div class="ms-1 w-9 rounded bg-info text-white ts-small text-center">
                        {{node.abbreviation}}</div>

                    @if (node.hasSemantic) {
                    <div class="ms-1 flex-grow-1 text-nowrap">
                        <a (click)="openSubmodel(node.submodel)" href="javascript:void(0);">{{node.name}}</a>
                        <span class="text-secondary">&nbsp;[</span>
                        <span class="text-secondary text-nowrap">{{node.typeInfo}}</span>
                        <span class="text-secondary">]</span>
                    </div>
                    }@else {
                    <div class="ms-1 flex-grow-1 text-nowrap">
                        <b>{{node.name}}</b>
                        <span class="text-secondary">&nbsp;[</span>
                        <span class="text-secondary text-nowrap">{{node.typeInfo}}</span>
                        <span class="text-secondary">]</span>
                    </div>
                    }
                </div>
            </td>
            @if (node.isLeaf) {
            <td class="text-end">
                @switch(node.element.modelType) {
                @case ('AnnotatedRelationshipElement') {
                <div class="d-flex flex-column ts-x-small me-2">
                    <a href="javascript:void(0);" class="text-nowrap"
                        (click)="openReference(node.annotatedRelationship?.first)">{{toString(node.annotatedRelationship?.first)}}</a>
                    <a href="javascript:void(0);" class="text-nowrap"
                        (click)="openReference(node.annotatedRelationship?.second)">{{toString(node.annotatedRelationship?.second)}}</a>
                </div>
                }
                @case ('Blob') {
                <a href="javascript:void(0);" class="text-nowrap me-2" (click)="openBlob(node.blob)">{{node.value}}</a>
                }
                @case('Entity') {
                <a href="javascript:void(0);" class="text-nowrap me-2"
                    (click)="openReference(node.entity?.globalAssetId)">{{node.value}}</a>
                }
                @case ('File') {
                <a href="javascript:void(0);" class="text-nowrap me-2" (click)="openFile(node.file)">{{node.value}}</a>
                }
                @case ('Operation') {
                <a href="javascript:void(0);" class="text-nowrap me-2"
                    (click)="openOperation(node.operation)">{{node.value}}</a>
                }
                @case ('ReferenceElement') {
                <a href="javascript:void(0);" class="text-nowrap me-2"
                    (click)="openReference(node.reference?.value)">{{node.value}}</a>
                }
                @case ('RelationshipElement') {
                <div class="d-flex flex-column ts-x-small me-2">
                    <a href="javascript:void(0);" class="text-nowrap"
                        (click)="openReference(node.relationship?.first)">{{toString(node.relationship?.first)}}</a>
                    <a href="javascript:void(0);" class="text-nowrap"
                        (click)="openReference(node.relationship?.second)">{{toString(node.relationship?.second)}}</a>
                </div>
                }
                @case ('Submodel') {}
                @case ('SubmodelElementCollection') {}
                @case ('SubmodelElementList') {}
                @default {
                <div class="text-nowrap me-2">{{node.value}}</div>
                }
                }
            </td>
            }
        </tr>
        }
    </tbody>
</table>
} @else {
<div class="alert alert-info text-center mt-2" role="alert">{{message}}</div>
}